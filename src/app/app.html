@if (showWelcome()) {
  <div class="welcome-overlay">
    <div class="welcome-card">
      <img src="/assets/logoMistery.png" alt="Mystery Hunter Logo" class="mystery-logo">
  
      <h1 class="mystery-title">
        Mystery <span class="gold">Hunter</span>
      </h1>
      
      <div class="description-box">
        <p>Bienvenido a una aventura de misterios y descubrimientos.</p>
        
        <ul>
          <li>Explora lugares emblem√°ticos</li>
          <li>Resuelve acertijos desafiantes</li>
          <li>Desbloquea historias ocultas</li>
          <li>Compite en el ranking global</li>
        </ul>
        
        <p><strong>¬°Que comience la b√∫squeda!</strong></p>
        
        <input 
          type="text" 
          #playerNameInput
          placeholder="Escribe tu nombre..." 
          style="width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #d4af37; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
        
        @if (nameError()) {
          <div style="background: rgba(239, 68, 68, 0.15); border: 1px solid #ef4444; color: #fca5a5; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.9rem; text-align: center; animation: shake 0.3s ease;">
            {{ nameError() }}
          </div>
        }
      </div>
      
      <button class="start-button" (click)="closeWelcomeWithName(playerNameInput.value)">
        Empezar Aventura
      </button>
    </div>
  </div>
}

<div id="map" style="height: 100vh; width: 100%"></div>

<div class="score-container">üèÜ Puntos: {{ totalPoints() }}</div>

<div class="ranking-container" [class.expanded]="showRanking()">
  <button class="ranking-toggle" (click)="toggleRanking()">
    <span class="icon">üèÜ</span>
    <span class="text">Ranking</span>
  </button>

  @if (showRanking()) {
    <div class="ranking-content">
      <h3 class="ranking-title">üèÜ Top Jugadores</h3>

      @if (loadingRanking()) {
        <div class="loading">Cargando...</div>
      } @else if (topPlayers().length === 0) {
        <div class="no-players">No hay jugadores a√∫n</div>
      } @else {
        <div class="players-list">
          <!-- ‚úÖ CAMBIADO: Ahora usa getVisiblePlayers() en lugar de topPlayers() -->
          @for (player of getVisiblePlayers(); track player.id; let idx = $index) {
            <div class="player-item" [class.current-user]="player.nombre === userId">
              <div class="rank">
                @if (idx === 0) {
                  <span class="medal gold">ü•á</span>
                } @else if (idx === 1) {
                  <span class="medal silver">ü•à</span>
                } @else if (idx === 2) {
                  <span class="medal bronze">ü•â</span>
                } @else {
                  <span class="position">#{{ idx + 1 }}</span>
                }
              </div>

              <div class="player-info">
                <span class="player-name">
                  {{ player.nombre }}
                  @if (player.nombre === userId) {
                    <span class="you-badge">(T√∫)</span>
                  }
                </span>
                <span class="mysteries-count">
                  {{ player.misteriosResueltos || 0 }} misterios
                </span>
              </div>

              <div class="player-points">
                {{ player.puntos }}
                <span class="pts">pts</span>
              </div>
            </div>
          }
        </div>

        <!-- ‚úÖ NUEVO: Bot√≥n para mostrar m√°s jugadores (solo aparece si hay m√°s de 6) -->
        @if (topPlayers().length > 6) {
          <button class="show-more-btn" (click)="toggleShowAllPlayers()">
            @if (showAllPlayers()) {
              <span>‚ñ≤ Mostrar menos</span>
            } @else {
              <span>‚ñº Ver m√°s jugadores</span>
            }
          </button>
        }
      }

      @if (userRank() && userRank()! > 10) {
        <div class="user-position">
          <div class="separator">...</div>
          <div class="player-item current-user">
            <div class="rank">
              <span class="position">#{{ userRank() }}</span>
            </div>
            <div class="player-info">
              <span class="player-name">
                {{ userId }}
                <span class="you-badge">(T√∫)</span>
              </span>
            </div>
            <div class="player-points">
              {{ totalPoints() }}
              <span class="pts">pts</span>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>

@if (showSuccessModal()) {
  <div class="success-modal-overlay">
    <div class="success-modal" (click)="$event.stopPropagation()">
      <div class="success-emoji">üéâ</div>
      <h2 class="success-title">¬°Felicidades!</h2>
      <p class="success-subtitle">Has resuelto el misterio de</p>
      <p class="success-mystery-title">{{ solvedMysteryTitle() }}</p>
      <div class="success-points">+{{ earnedPoints() }} puntos</div>
      <button class="success-close-btn" (click)="closeSuccessModal()">Continuar</button>
    </div>
  </div>
}

@if (selectedMystery()) {
  <div class="mystery-card-overlay">
    <div class="mystery-card">
      <button class="close-btn" (click)="selectedMystery.set(null)">√ó</button>

      <div class="card-header">
        <h2>{{ selectedMystery().titulo }}</h2>
      </div>

      <div class="card-body">
        <p class="description">{{ selectedMystery().descripcion }}</p>

        <div class="riddle-section">
          <span class="riddle-label">üîç El Acertijo:</span>
          <p class="riddle-text">{{ selectedMystery().acertijo }}</p>
        </div>

        <div class="answer-section">
          <input
            type="text"
            placeholder="Escribe la respuesta..."
            #userAnswer
            (keyup.enter)="checkAnswer(userAnswer.value)"
          />
          <button (click)="checkAnswer(userAnswer.value)">Comprobar</button>
        </div>
      </div>
    </div>
  </div>
}

<router-outlet></router-outlet>